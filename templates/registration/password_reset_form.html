{% extends 'globals/base.html' %}
{% load static %}

{% block title %}
AlumniConnect - Password Reset
{% endblock %}

{% block body %}
{% include 'globals/navbar.html' %}
<div class="p-0 m-0 masthead-bg w-100 h-100 parallax" style="min-height:300px !important; height:300px !important; background-position-y: 300px;"></div>

<header class="masthead text-center text-white d-flex" style="height:0px; min-height:300px;">
    <div class="container my-auto" style="margin-bottom:50px !important;">
        <div class="row">
            <div class="col-lg-2 mx-auto align-middle">
                <h2 class="text-uppercase">
                    <a href="{% url 'home' %}"><img src="{% static 'AlumniConnect/img/logo/alumb1.png' %}" style="width: 4em; height: auto;"></a>
                </h2>
            </div>
            <div class="col-lg-8 mx-auto align-middle">
                <h1 class="text-uppercase mt-4">
                    <strong>ALUMNI CONNECT</strong>
                </h1>
            </div>
        </div>
    </div>
</header>

<section id="services" class="bg-primary p-1">
</section>

<div class="bg-white">
    <div class="login-container container text-left p-2 mx-auto">
        <div class="card shadow m-4 bg-light">
            <div class="col-lg-12 mx-auto">
                <div class="row text-center">
                    <div class="col-lg-12 text-primary pt-4 mt-4">
                        <h2>Forgot Password</h2>
                        <hr class="mb-4">
                    </div>
                </div>
                <div class="row text-center mb-4 pb-4 pt-3 justify-content-center">
                    <div class="col-sm-11 col-md-10 col-lg-9">
                        <form method="POST" class="font-open-sans" onsubmit="return validateForm(event)">
                            {% csrf_token %}
                           <span id="email-error" style="display: none; color: red;">Email does not exist.</span>
                            <div class="form-group">
                                <label class="d-block text-left" for="{{ form.email.id_for_label }}">Email:</label>
                                <input id="{{ form.email.id_for_label }}" type="email" name="email" class="form-control" placeholder="Email" required>
                            </div>
                            <button class="btn btn-primary px-5 py-2 mt-3" value="submit" type="submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    async function validateForm(event) {
        var emailInput = document.querySelector('#{{ form.email.id_for_label }}');
        var emailError = document.querySelector('#email-error');
        
        event.preventDefault(); // Prevent form submission
        {% comment %} console.log(emailInput.value) {% endcomment %}
        try {
          const exists = await checkEmailExists(emailInput.value);
          
          if (!exists) {
            emailError.style.display = 'inline';
          } else {
            emailError.style.display = 'none';
            event.target.submit(); // Allow form submission
          }
        } catch (error) {
          console.error('An error occurred:', error);
        }
      }
    // Function to check if email exists (replace with your own implementation)
    async function checkEmailExists(email) {
        try {
          const response = await fetch('/check-email-exists/?email=' + encodeURIComponent(email));
          
          if (!response.ok) {
            throw new Error('Error checking email existence');
          }
          
          const data = await response.json();
          return data.exists;
        } catch (error) {
          throw error;
        }
      }
  </script>

{% include 'globals/footer.html' %}
{% endblock %}